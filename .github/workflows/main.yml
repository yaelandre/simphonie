# cd.yaml 
name: Pipeline-CI 
on: 
  push: 
    branches: [ main ] 
jobs: 
  ci: 
    runs-on: ubuntu-latest
    steps: 
    # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it 
    - uses: actions/checkout@v2 
    # https://github.com/shivammathur/setup-php (community) 
    - name: Setup PHP, extensions and composer with shivammathur/setup-php 
      uses: shivammathur/setup-php@v2 
      with: 
        extensions: mbstring, xml, ctype, iconv, intl, pdo, pdo_mysql, dom, filter, gd, iconv, json, mbstring, pdo
    - name: Cachemultiple paths
      uses: actions/cache@v3.3.2
      with:
        path:
          vendor
        key: ${{ runner.os }}-${{ hashFiles('composer.lock') }}

    - name: "composer install"
      run: composer install --no-interaction --no-progress
      
    # install Symfony CLI
    - name: Symfony CLI
      run: |
        curl -sS https://get.symfony.com/cli/installer | bash 
        mv /home/runner/.symfony5/bin/symfony /usr/local/bin/symfony 
    # Check vulnerabilities 
    - name: Symfony5 Check Vulnerabilities 
      run: symfony5 check:security
      
          
    # PHP CS FIXER 
    - name: PHP-CS-Fixer 
        run:|
        composer require friendsofphp/php-cs-fixer
        ./vendor/bin/php-cs-fixer fix --dry-run

    # PHP STAN
    - name: PHP Stan
      run: |
        ./vendor/bin/simple-phpunit install
        composer require phpstan/phpstan
        composer require phpstan/extension-installer
        composer require phpstan/phpstan-symfony
        ./vendor/bin/phpstan analyse src --memory-limit 1G
        continue-on-error:true
    - name: LS 
      run: ls
